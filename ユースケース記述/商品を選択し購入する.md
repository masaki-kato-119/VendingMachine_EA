# ユースケース: 商品を選択し購入する

## 概要
利用者が自動販売機へお金（現金またはキャッシュレス）を投入し、希望する商品を選択して購入・受け取るまでの一連の流れ。

## アクター
- 利用者

## 事前条件
- 自動販売機が稼働中であること

## 事後条件
- 利用者が選択した商品を受け取るか、未購入分のお金が返却される

## 基本フロー

| フローID | 内容 |
|:---:|:----|
| BF-1 | 利用者は現金（硬貨または紙幣）、もしくはキャッシュレス決済を投入・認証する。 |
| BF-2 | システムは投入金額（または決済可否）を確認し、選択可能な商品を表示する。 |
| BF-3 | 利用者は購入したい商品の選択ボタンを押下する。 |
| BF-4 | システムは選択された商品の在庫および釣銭状況を確認する。 |
| BF-5 | 購入可能な場合、商品を払い出し、必要に応じてお釣りを払い出す。 |
| BF-6 | 利用者が商品（とお釣り）を受け取る。 |

### 分岐
- 【BF-2】や【BF-4】で商品在庫切れや釣銭不足時、例外フロー【EF-1】【EF-2】へ。
- 【BF-1】や【BF-2】で投入金額不足時、基本フロー【BF-1】へ戻って追加投入を促す。
- 【BF-1】【BF-2】【BF-3】～で利用者取引キャンセル時、代替フロー【AF-1】へ。

## 代替フロー

| フローID | 内容 |
|:---:|:----|
| AF-1-1 | 利用者がキャンセル操作をする、または一定時間操作がなかった場合取引タイムアウトとなる。 |
| AF-1-2 | システムは投入金額のうち未使用分の金額を全額返却する。 |
| AF-1-3 | 処理終了。 |

## 例外フロー

| フローID | 内容 |
|:---:|:----|
| EF-1-1 | 商品ボタン押下時【BF-4】、在庫切れまたは販売停止・メカトラブル等で購入できない場合、エラーを表示し再選択を促す。 |
| EF-1-2 | 利用者は別の商品を選択（【BF-3】へ戻る）または取引終了時はAF-1に進む。 |

| フローID | 内容 |
|:---:|:----|
| EF-2-1 | 商品選択時【BF-4/5】釣銭切れでお釣りが払えない場合、エラー通知・購入不可を表示。 |
| EF-2-2 | 利用者は別の商品（お釣り不要な商品等）を選択（【BF-3】へ）、または取引キャンセル（AF-1へ）。 |

## 備考
- 投入金額未満の商品ボタンは選択できないよう照明消灯等で制御されている場合が多い。
- キャッシュレス決済の場合は投入→商品選択→認証→商品払い出し、となる場合もある（運用に応じて要調整）。
- 商品受領やお釣り取り忘れ時のアラート等は省略。

