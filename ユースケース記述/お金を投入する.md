# ユースケース: お金を投入する

## 概要
利用者が自動販売機に現金もしくはキャッシュレス手段でお金を投入し、投入金額が増えるごとに選択可能な商品の選択状態を更新する。

## アクター
- 利用者

## 事前条件
- 自動販売機が稼働中であること

## 事後条件
- システムが投入された金額を正しく認識し、現時点で購入可能な商品を表示する。

## 基本フロー

| フローID | 内容 |
|:---:|:----|
| BF-1 | 利用者は現金（硬貨・紙幣）またはキャッシュレス決済手段で支払い操作を行う。 |
| BF-2 | システムは投入された金額を認識し、画面やディスプレイに合計投入金額を表示する。 |
| BF-3 | システムは現在の投入金額で購入可能な商品ボタンを点灯/選択可に、金額不足の商品ボタンを消灯/選択不可にする。 |
| BF-4 | 利用者は投入を継続するか（【BF-1】）、商品選択（「商品を選択し購入する」ユースケースへ遷移）を行う。 |

### 分岐
- 【BF-1】で受け入れ不可なコイン・紙幣・カードの投入、不正操作、読み取りエラーの場合→例外フロー【EF-1】へ
- 【BF-2】で金額認識不能の場合→例外フロー【EF-2】へ
- 【BF-4】で取引キャンセルや一定時間無操作の場合→代替フロー【AF-1】へ

## 代替フロー

| フローID | 内容 |
|:---:|:----|
| AF-1-1 | 利用者がキャンセルボタンを押す、または一定時間無操作の場合。 |
| AF-1-2 | システムは投入済みの金額（未使用分）を返却する。 |
| AF-1-3 | 処理終了。 |

## 例外フロー

| フローID | 内容 |
|:---:|:----|
| EF-1-1 | 投入されたお金・カード等が使用不可能（破損、異物、規格外等）の場合、システムは該当投入物を返却し、「使用できません」と通知する。 |
| EF-1-2 | 利用者は再度投入するか、取引をキャンセルする（必要に応じてAF-1-1へ）。 |

| フローID | 内容 |
|:---:|:----|
| EF-2-1 | 金額認識機構に障害が発生した場合、システムは全投入金額を返却しエラー表示を行う。 |
| EF-2-2 | 処理終了。 |

## 備考
- 硬貨・紙幣は受入不可額を自動で返却し、金額認識不能時はシステムエラーとする。
- 商品購入までに投入額を超える商品は自動的に選択不可状態に制御されている。
- 商品選択後も追加投入できる仕様の機種もあるが、その場合はフロー調整が必要。